<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#2a8a7a" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#3ba897" media="(prefers-color-scheme: dark)" />

    <title inertia>
      Edonis LMS
    </title>

    {{-- Typography: Source Serif Pro for headings, Inter for body --}}
    <link rel="preconnect" href="https://fonts.bunny.net" />
    <link
      href="https://fonts.bunny.net/css?family=source-serif-4:400,500,600,700|inter:400,500,600,700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --font-heading: 'Source Serif 4', Georgia, serif;
        --font-body: 'Inter', system-ui, sans-serif;
      }

      body {
        font-family: var(--font-body);
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      .font-heading {
        font-family: var(--font-heading);
      }

      /* Prevent FOUT */

      .fonts-loading {
        opacity: 0;
      }

      .fonts-loaded {
        opacity: 1;
        transition: opacity 0.2s ease;
      }
    </style>

    @stack('dumper')
    @viteReactRefresh()
    @inertiaHead()
    @vite(['inertia/app/app.tsx', `inertia/pages/${page.component}.tsx`])
  </head>

  <body class="font-sans antialiased">
    @inertia()

    @if(dbError && isDebug)
      <div id="db-error-banner" style="
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        background: #dc2626;
        color: #fff;
        font-size: 0.8125rem;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 99999;
        box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
      ">
        {{-- Header bar --}}
        <div style="
          max-width: 960px;
          margin: 0 auto;
          padding: 0.75rem 1rem;
          display: flex;
          align-items: center;
          gap: 0.625rem;
          flex-wrap: wrap;
        ">
          <span style="
            background: rgba(255,255,255,0.2);
            font-size: 0.6875rem;
            font-weight: 700;
            padding: 0.125rem 0.5rem;
            border-radius: 999px;
            letter-spacing: 0.03em;
          ">DATABASE</span>
          <span style="font-weight: 600;">{{ dbError.name }}</span>
          <span style="opacity: 0.85; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{ dbError.message }}</span>
          <button onclick="document.getElementById('db-error-banner').remove()" style="
            background: rgba(255,255,255,0.15);
            border: none;
            color: #fff;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
          " title="Fermer">&times;</button>
        </div>

        {{-- Expandable stack trace --}}
        <details style="max-width: 960px; margin: 0 auto;">
          <summary style="
            padding: 0.375rem 1rem 0.625rem;
            cursor: pointer;
            font-size: 0.75rem;
            opacity: 0.7;
            user-select: none;
          ">Stack trace</summary>
          <div style="position: relative;">
            <button id="db-copy-btn" onclick="
              var text = document.getElementById('db-stack-trace').textContent;
              navigator.clipboard.writeText(text).then(function() {
                var btn = document.getElementById('db-copy-btn');
                btn.innerHTML = '<svg width=&quot;14&quot; height=&quot;14&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;><polyline points=&quot;20 6 9 17 4 12&quot;></polyline></svg>';
                setTimeout(function() {
                  btn.innerHTML = '<svg width=&quot;14&quot; height=&quot;14&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;><rect x=&quot;9&quot; y=&quot;9&quot; width=&quot;13&quot; height=&quot;13&quot; rx=&quot;2&quot; ry=&quot;2&quot;></rect><path d=&quot;M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1&quot;></path></svg>';
                }, 1500);
              });
            " style="
              position: absolute;
              top: 0.5rem;
              right: 1rem;
              background: rgba(255,255,255,0.15);
              border: none;
              color: #fff;
              width: 1.75rem;
              height: 1.75rem;
              border-radius: 0.25rem;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              flex-shrink: 0;
              transition: background 0.15s;
            " title="Copier le stack trace">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
            </button>
            <pre id="db-stack-trace" style="
              margin: 0;
              padding: 0.75rem 1rem 1rem;
              padding-right: 3rem;
              font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Fira Code', monospace;
              font-size: 0.6875rem;
              line-height: 1.7;
              overflow-x: auto;
              white-space: pre-wrap;
              word-break: break-all;
              background: rgba(0,0,0,0.15);
              color: rgba(255,255,255,0.9);
              max-height: 40vh;
              overflow-y: auto;
            ">{{ dbError.stack }}</pre>
          </div>
        </details>
      </div>
    @end

    <script>
      // Font loading detection
      if ("fonts" in document) {
        document.body.classList.add("fonts-loading");
        Promise.all([ document.fonts.load("400 1em Inter"), document.fonts.load('400 1em "Source Serif 4"') ]).then(() => {
          document.body.classList.remove("fonts-loading");
          document.body.classList.add("fonts-loaded");
        });
      }
    </script>
  </body>

</html>
